import helpers.hunit_test as hunitest
import os
import helpers.hio as hio
import oms.hsecrets as homssec


class TestFilledOrderReader1(hunitest.TestCase):
    _secret_identifier = homssec.SecretIdentifier("binance", "test", "sandbox", 1)
    def setUp(self):
        super().setUp()

    def get_test_data(self):
        test_json1 = [
            {
                "info": {
                    "symbol": "APEUSDT",
                    "id": "282773274",
                    "orderId": "5772340563",
                    "side": "SELL",
                    "price": "5.4270",
                    "qty": "5",
                    "realizedPnl": "0",
                    "marginAsset": "USDT",
                    "quoteQty": "27.1350",
                    "commission": "0.01085400",
                    "commissionAsset": "USDT",
                    "time": "1664469999509",
                    "positionSide": "BOTH",
                    "buyer": False,
                    "maker": False,
                },
                "timestamp": 1664469999509,
                "datetime": "2022-09-29T16:46:39.509Z",
                "symbol": "APE/USDT",
                "id": "282773274",
                "order": "5772340563",
                "type": None,
                "side": "sell",
                "takerOrMaker": "taker",
                "price": 5.427,
                "amount": 5.0,
                "cost": 27.135,
                "fee": {"cost": 0.010854, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.010854}],
            },
            {
                "info": {
                    "symbol": "APEUSDT",
                    "id": "282775654",
                    "orderId": "5772441841",
                    "side": "BUY",
                    "price": "5.3980",
                    "qty": "6",
                    "realizedPnl": "0.14500000",
                    "marginAsset": "USDT",
                    "quoteQty": "32.3880",
                    "commission": "0.01295520",
                    "commissionAsset": "USDT",
                    "time": "1664470318567",
                    "positionSide": "BOTH",
                    "buyer": True,
                    "maker": False,
                },
                "timestamp": 1664470318567,
                "datetime": "2022-09-29T16:51:58.567Z",
                "symbol": "APE/USDT",
                "id": "282775654",
                "order": "5772441841",
                "type": None,
                "side": "buy",
                "takerOrMaker": "taker",
                "price": 5.398,
                "amount": 6.0,
                "cost": 32.388,
                "fee": {"cost": 0.0129552, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.0129552}],
            },
            {
                "info": {
                    "symbol": "APEUSDT",
                    "id": "282779084",
                    "orderId": "5772536135",
                    "side": "BUY",
                    "price": "5.4070",
                    "qty": "3",
                    "realizedPnl": "0",
                    "marginAsset": "USDT",
                    "quoteQty": "16.2210",
                    "commission": "0.00648840",
                    "commissionAsset": "USDT",
                    "time": "1664470620267",
                    "positionSide": "BOTH",
                    "buyer": True,
                    "maker": False,
                },
                "timestamp": 1664470620267,
                "datetime": "2022-09-29T16:57:00.267Z",
                "symbol": "APE/USDT",
                "id": "282779084",
                "order": "5772536135",
                "type": None,
                "side": "buy",
                "takerOrMaker": "taker",
                "price": 5.407,
                "amount": 3.0,
                "cost": 16.221,
                "fee": {"cost": 0.0064884, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.0064884}],
            },
        ]
        test_json2 = [
            {
                "info": {
                    "symbol": "AVAXUSDT",
                    "id": "400396688",
                    "orderId": "12598181143",
                    "side": "BUY",
                    "price": "17.3600",
                    "qty": "2",
                    "realizedPnl": "0",
                    "marginAsset": "USDT",
                    "quoteQty": "34.7200",
                    "commission": "0.01388800",
                    "commissionAsset": "USDT",
                    "time": "1664879819754",
                    "positionSide": "BOTH",
                    "buyer": True,
                    "maker": False,
                },
                "timestamp": 1664879819754,
                "datetime": "2022-10-04T10:36:59.754Z",
                "symbol": "AVAX/USDT",
                "id": "400396688",
                "order": "12598181143",
                "type": None,
                "side": "buy",
                "takerOrMaker": "taker",
                "price": 17.36,
                "amount": 2.0,
                "cost": 34.72,
                "fee": {"cost": 0.013888, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.013888}],
            },
            {
                "info": {
                    "symbol": "AVAXUSDT",
                    "id": "400396907",
                    "orderId": "12598270086",
                    "side": "SELL",
                    "price": "17.3300",
                    "qty": "7",
                    "realizedPnl": "-0.12000000",
                    "marginAsset": "USDT",
                    "quoteQty": "121.3100",
                    "commission": "0.04852400",
                    "commissionAsset": "USDT",
                    "time": "1664880124173",
                    "positionSide": "BOTH",
                    "buyer": False,
                    "maker": False,
                },
                "timestamp": 1664880124173,
                "datetime": "2022-10-04T10:42:04.173Z",
                "symbol": "AVAX/USDT",
                "id": "400396907",
                "order": "12598270086",
                "type": None,
                "side": "sell",
                "takerOrMaker": "taker",
                "price": 17.33,
                "amount": 7.0,
                "cost": 121.31,
                "fee": {"cost": 0.048524, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.048524}],
            },
            {
                "info": {
                    "symbol": "AVAXUSDT",
                    "id": "400397431",
                    "orderId": "12598362254",
                    "side": "BUY",
                    "price": "17.3600",
                    "qty": "6",
                    "realizedPnl": "-0.09000000",
                    "marginAsset": "USDT",
                    "quoteQty": "104.1600",
                    "commission": "0.04166400",
                    "commissionAsset": "USDT",
                    "time": "1664880419818",
                    "positionSide": "BOTH",
                    "buyer": True,
                    "maker": False,
                },
                "timestamp": 1664880419818,
                "datetime": "2022-10-04T10:46:59.818Z",
                "symbol": "AVAX/USDT",
                "id": "400397431",
                "order": "12598362254",
                "type": None,
                "side": "buy",
                "takerOrMaker": "taker",
                "price": 17.36,
                "amount": 6.0,
                "cost": 104.16,
                "fee": {"cost": 0.041664, "currency": "USDT"},
                "fees": [{"currency": "USDT", "cost": 0.041664}],
            },
        ]
        scratch_json_space = os.path.join(self.get_scratch_space(), "json/")
        json1_path = os.path.join(scratch_json_space, "fills_20220929-160000_20220929-170000")
        hio.to_json(test_json1, json1_path)
        json2_path = os.path.join(scratch_json_space, "fills_20221004-100000_20221004-110000")
        hio.to_json(test_json2, json2_path)
