<!--ts-->
   * [Connecting Google Sheets to Pandas](#connecting-google-sheets-to-pandas)
   * [Installing gspread-pandas](#installing-gspread-pandas)
   * [Configuring gspread-pandas](#configuring-gspread-pandas)
   * [Using gspread-pandas](#using-gspread-pandas)



<!--te-->

# Connecting Google Sheets to Pandas

- In order to load a google sheet into a pandas dataframe (or the other way
  around), one can use a library called `gspread-pandas`.

## Installing gspread-pandas

- The library should be automatically installed in your conda env
  - The detailed instructions on how to install the library are located here:
    [Installation/Usage](https://gspread-pandas.readthedocs.io/en/latest/getting_started.html#installation-usage).

## Configuring gspread-pandas

- Client credentials need to be generated by each user independently.
  - The instructions are provided
    [here](https://gspread-pandas.readthedocs.io/en/latest/getting_started.html#client-credentials).
  - The process is not complicated but it's not obvious since you need to click
    around in the GUI

- Some gotchas:
  - Make sure to act only under your `...` account.
  - `project/product/application` names don't really matter. It's convenient to
    pick a name connected to the project so that it's easy to find later.
  - Whenever you are given a choice of making something generally accessible or
    accessible only to the members of your organization, choose making it
    accessible only to the members of your organization.
  - When you are given a choice of time periods to create something for, choose
    the longest one.
  - When you are given a choice between `OAuth client ID` and `Service account`,
    choose `OAuth client ID`.

- To use the library on the server, the downloaded JSON with the credentials
  needs to be stored on your laptop
  ```bash
  > export SRC_FILE="~/Downloads/client_secret_4642711342-ib06g3lbv6pa4n622qusqrjk8j58o8k6.apps.googleusercontent.com.json"
  > export DST_DIR="~/.config/gspread_pandas"
  > export DST_FILE="$DST_DIR/google_secret.json"
  > mkdir -p $DST_DIR
  > mv $SRC_FILE $DST_FILE
  > chmod 600 $DST_FILE
  ```
  and copy that on the server, e.g.,
  ```bash
  > ssh research "mkdir -p $DST_DIR"
  > scp $SRC_FILE research:$DST_FILE
  > ssh research "chmod 600 $DST_FILE"
  ``

# Using gspread-pandas

- The notebook with the usage example is located at
  `amp/core/notebooks/gsheet_into_pandas_example.ipynb`.

- The first time the library is used, it will asks the user for an authorization
  code.

![image](https://user-images.githubusercontent.com/22771988/78498562-4e695580-774b-11ea-9f4e-08a413567e24.png)

- After the authorization code is provided for the first time, it won't be asked
  again.

- The official use documentation is provided
  [here](https://gspread-pandas.readthedocs.io/en/latest/using.html).

- **Don't feel stupid if you need multiple iterations to get this stuff
  working**
  - Clicking on GUI is always a recipe for low productivity
  - Go command line and vim!
